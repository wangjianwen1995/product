(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e65a78d"],{"6f11":function(e,t,a){"use strict";a("e08a")},"83ee":function(e,t,a){},b08e:function(e,t,a){"use strict";a("83ee")},e08a:function(e,t,a){},fc42:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{direction:"horizontal"}},[a("data-list",{attrs:{entity:e.entity}})],1)},o=[],i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dataList-container",staticStyle:{width:"100%",padding:"20px"}},[a("el-page-header",{attrs:{content:"预览"},on:{back:e.goBack}}),a("div",{staticStyle:{"padding-top":"20px"}},[a("el-form",{attrs:{model:e.queryForm,inline:"",size:"small"}},[e._l(e.queryList,(function(t,r){return a("el-form-item",{key:r,attrs:{label:t.label}},[7==t.type?[a("el-date-picker",{attrs:{type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}})]:e._e(),"option"==t.type||"options"==t.type||"checkbox"==t.type||"radio"==t.type?[a("el-select",{attrs:{filterable:"",clearable:"",multiple:"","collapse-tags":""},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}},e._l(t.optionList,(function(e,t){return a("el-option",{key:t,attrs:{value:e.val,label:e.name}})})),1)]:e._e(),"sql"==t.type||"sqls"==t.type?[a("el-select",{attrs:{filterable:"",clearable:"",remote:"",multiple:"","collapse-tags":"","remote-method":function(a){return e.remoteMethod(a,t)}},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}},e._l(t.optionList,(function(e,t){return a("el-option",{key:t,attrs:{value:e.val,label:e.name}})})),1)]:e._e(),1==t.type||2==t.type||3==t.type||4==t.type?[a("el-input",{model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}})]:e._e(),8==t.type?[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}})]:e._e(),9==t.type?[a("el-date-picker",{attrs:{type:"year",placeholder:"选择年","value-format":"yyyy"},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}})]:e._e(),10==t.type?[a("el-date-picker",{attrs:{type:"month",placeholder:"选择月","value-format":"yyyy-MM"},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}})]:e._e(),11==t.type?[a("el-time-picker",{attrs:{"is-range":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围","value-format":"HH:mm:ss"},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}})]:e._e()],2)})),e.flowFlag?a("el-form-item",{attrs:{label:"流程状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{filterable:"",clearable:""},model:{value:e.queryForm["toexamine_result"],callback:function(t){e.$set(e.queryForm,"toexamine_result",t)},expression:"queryForm['toexamine_result']"}},[a("el-option",{attrs:{value:9,label:"完成"}}),a("el-option",{attrs:{value:0,label:"未开始"}}),a("el-option",{attrs:{value:1,label:"进行中"}}),a("el-option",{attrs:{value:-1,label:"驳回"}})],1)],1):e._e(),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.loadTableData}},[e._v(" 查询 ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.addNewRecord}},[e._v(" 新建 ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-download"},on:{click:e.handleDownload}},[e._v(" 导出 ")])],1)],2)],1),a("div",{ref:"tableContainer"},[a("div",{staticStyle:{height:"100%"}},[a("SimpleTable",{ref:"SimpleTable",attrs:{columns:e.columns,data:e.tableData,pagination:e.page,"show-check-box":!0,height:"auto","table-size":"small","table-width":"100% !important"},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1),e.showFormDialogFlag?a("el-dialog",{attrs:{title:e.formTitle,visible:e.showFormDialogFlag,"destroy-on-close":!0,"close-on-click-modal":!1,"show-close":!0,"close-on-press-escape":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.showFormDialogFlag=t}}},[e.oneToOneChilds.length?a("el-alert",{staticStyle:{margin:"-30px -20px 20px -20px",width:"auto"},attrs:{title:"子表单",type:"success",closable:!1}},[a("div",{attrs:{slot:"title"},slot:"title"},[e._l(e.oneToOneChilds,(function(t,r){return[a("el-tag",{key:r,attrs:{closable:""},on:{close:function(a){return e.handleRemove(t)}}},[a("el-button",{staticStyle:{padding:"0"},attrs:{size:"mini",type:"text"},on:{click:function(a){return e.toSubForm(t)}}},[e._v(" "+e._s(t.table_name_zh)+" ")])],1)]}))],2)]):e._e(),a("FormWidget",{ref:"formWidget",attrs:{entity:e.entity,layout:e.layout,"form-model":e.formModel,"field-props-map":e.fieldPropsMap,dataid:e.data_id,"labels-model":e.labelsModel,"form-state":e.formState,userrole:e.userRole,"one-to-one-childs":e.oneToOneChilds},on:{setFormModel:e.setValue,setChildrens:e.setChildrens}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.hadelCancel}},[e._v("取 消")]),3==e.formState?a("el-button",{staticStyle:{width:"90px"},attrs:{type:"primary",size:"small"},on:{click:e.hadelPrint}},[e._v(" 打 印 ")]):e._e()],1)],1):e._e()],1)],1)},n=[],s=a("1da1"),l=(a("96cf"),a("4de4"),a("d3b7"),a("b0c0"),a("159b"),a("99af"),a("e9c4"),a("c65d")),c=a("9321"),u=a("365c"),d=a("ca00"),m=a("2b0e"),p=a("09ca"),h={name:"DataList",components:{FormWidget:l["default"]},props:{entity:{type:Object,default:function(){}},customAddAction:{type:Boolean,default:!1},customEditAction:{type:Boolean,default:!1},customDeleteAction:{type:Boolean,default:!1},customDataLoad:{type:Boolean,default:!1},page:{type:Object,default:function(){return{pageNo:1,limit:20,sizes:[10,20,30,50,100],total:0}}},crudMethods:{type:Object,default:function(){return{initDataList:u["x"],createRecord:u["a"],updateRecord:u["N"],saveRecord:u["G"],deleteRecord:u["f"]}}}},data:function(){return{value:"",dialogVisible3:!1,oneToOneChilds:[],dialogVisible:!1,entityLabel:"",idFieldName:null,nameFieldName:null,curRecordId:null,keyword:"",searchFilter:"",columns:[],tableData:[],showFormDialogFlag:!1,layout:{},formState:1,formModel:{},labelsModel:{},fieldPropsMap:{},formModelCopy:{},queryForm:{},queryList:[],flowData:[],flowFlag:!1,userRole:null,data_id:null,selectRow:null}},computed:{tableHeight:function(){return this.$baseTableHeight()},formTitle:function(){return this.formState===c["a"].NEW?"新建"+this.entityLabel:this.formState===c["a"].EDIT?"编辑"+this.entityLabel:this.entityLabel+"详情"}},mounted:function(){var e=this;this.$nextTick((function(){e.resizeTableHeight()})),window.onresize=function(){e.resizeTableHeight()},this.initTable()},methods:{goBack:function(){this.$router.back(-1)},handleDownload:function(){},setChildrens:function(e){var t=this.oneToOneChilds.filter((function(t){return t.table_id==e.table_id}));t.length<=0&&this.oneToOneChilds.push(e)},hadelCancel:function(){this.showFormDialogFlag=!1},remoteMethod:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var o,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,getDataBySql({val:e},t.type_content);case 2:o=r.sent,i=o.t,a.$set(t,"optionList",i),a.$forceUpdate();case 6:case"end":return r.stop()}}),r)})))()},setValue:function(e){this.formModel[e.key]=e.value},handleExecute:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var o,i,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,executeToexamine(e);case 2:o=r.sent,o.t,i=o.state,n=o.msg,a.$message({type:i,message:n}),a.loadTableData(),t();case 9:case"end":return r.stop()}}),r)})))()},resizeTableHeight:function(){},getQueryForm:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["m"])({table_id:e.entity.id});case 2:a=t.sent,r=a.t,o=a.state,i=a.msg,"success"==o?e.queryList=r||[]:e.$message({message:i,type:"error"});case 7:case"end":return t.stop()}}),t)})))()},initTable:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.entity){t.next=3;break}return e.$message.error("entity of prop is null"),t.abrupt("return");case 3:if(!0!==e.customDataLoad){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,e.crudMethods.initDataList({table_id:e.entity.id,table_name:e.entity.name,pageNum:e.page.pageNo,pageSize:e.page.limit});case 7:if(a=t.sent,"error"!=a.state){t.next=11;break}return e.$message({message:a.msg,type:"error"}),t.abrupt("return");case 11:e.queryList=a.t&&a.t.conditionList?a.t.conditionList:[],e.$set(e.page,"total",a.t.pagination.total),e.setTableData(a.t.columnList,a.t.dataList),a&&a.t&&a.t.columnList&&a.t.columnList.length>0&&(e.flowFlag="toexamine_result"==a.t.columnList[a.t.columnList.length-1].prop);case 15:case"end":return t.stop()}}),t)})))()},setTableData:function(e,t){this.columns=e,this.columns.forEach((function(e){Object(d["setColumnFormatter"])(e)})),this.tableData=t,this.$refs.SimpleTable.tabeldata=t,this.$refs.SimpleTable.columns=e},loadTableData:function(e){var t=this,a={};_.forEach(this.queryForm,(function(e,t){_.isArray(e)?e.length>0&&(a[t]=e):e&&(a[t]=e)})),Object(u["o"])({table_id:this.entity.id,table_name:this.entity.name,pageSize:this.page.limit,pageNum:this.page.pageNo},a).then((function(e){"error"==e.state?t.$message({message:e.msg,type:"error"}):(t.tableData=e.t.dataList,t.$refs.SimpleTable.tabeldata=t.tableData,t.$set(t.page,"total",e.t.pagination.total),t.$set(t.page,"pageNo",e.t.pagination.pageNo))})).catch((function(e){t.$message({message:e.msg,type:"error"})}))},handleSizeChange:function(e){!0!==this.customDataLoad?(this.$set(this.page,"limit",e),this.loadTableData(this.searchFilter)):this.$emit("handleSizeChange",e)},handleCurrentChange:function(e){!0!==this.customDataLoad?(this.$set(this.page,"pageNo",e),this.loadTableData(this.searchFilter)):this.$emit("handleCurrentChange",e)},searchData:function(){if(!0!==this.customDataLoad)if(this.nameFieldName){var e=this.nameFieldName,t=this.keyword;this.searchFilter="([".concat(e,"] like '%").concat(t,"%')"),this.loadTableData(this.searchFilter)}else this.$message.error("当前实体["+this.entity+"]未指定名称字段，不能搜索！");else this.$emit("searchData",this.keyword)},clearSearch:function(){if(!0===this.customDataLoad)return this.keyword="",void this.$emit("clearSearch");this.searchFilter="",this.loadTableData()},refreshTableData:function(){!0!==this.customDataLoad?this.loadTableData(this.searchFilter):this.$emit("refreshTable")},addNewRecord:function(){var e=this;!0!==this.customAddAction?this.crudMethods.createRecord({table_id:this.entity.id,table_name:this.entity.name}).then(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("error"!=a.state){t.next=3;break}return e.$message({message:a.error,type:"error"}),t.abrupt("return");case 3:a.t&&a.t.layoutJson?(e.curRecordId=null,e.layout=e.buildLayoutObj(),e.layout.setLayoutPropsFromServer(a,"add"),e.handleDeletedFields(a),e.formModel=a.t.formData,e.formModelCopy=JSON.parse(JSON.stringify(a.t.formData)),e.labelsModel=a.t.labelData,e.fieldPropsMap=a.t.fieldPropsMap,e.formState=c["a"].NEW,e.showFormDialogFlag=!0,e.$refs["formWidget"]&&e.$refs["formWidget"].clearFormValidate(),e.oneToOneChilds=[]):e.$message({message:"加载表单布局出错",type:"error"});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.$message({message:t.message,type:"error"})})):this.$emit("addTableRecord")},buildLayoutObj:function(){var e=new m["default"];return Object(p["a"])(e)},handleDeletedFields:function(e){var t=e.t.deletedFields;if(t&&Array.isArray(t)){var a=this.layout.getAllLayoutFieldWrappers();a&&Array.isArray(a)&&a.forEach((function(e){var a=Object(d["arrayContain"])(t,e.name);a&&(e.deleted=!0)}))}},editTableData:function(e){var t=this;!0!==this.customEditAction?(this.curRecordId=e[this.idFieldName],this.crudMethods.updateRecord({data_id:e.id,table_id:this.entity.id,table_name:this.entity.name}).then((function(e){"error"!=e.state?e.t&&e.t.layoutJson?(t.layout=t.buildLayoutObj(),t.layout.setLayoutPropsFromServer(e,"add"),t.handleDeletedFields(e),t.formModel=e.t.formData,t.formModelCopy=JSON.parse(JSON.stringify(e.t.formData)),t.labelsModel=e.t.labelData,t.fieldPropsMap=e.t.fieldPropsMap,t.formState=c["a"].EDIT,t.showFormDialogFlag=!0,t.$refs["formWidget"]&&t.$refs["formWidget"].clearFormValidate()):t.$message({message:"加载表单布局出错",type:"error"}):t.$message({message:e.msg,type:"error"})})).catch((function(e){t.$message({message:e.message,type:"error"})}))):this.$emit("editTableRow",e)},hadelSave:function(e){var t=this;this.crudMethods.saveRecord({table_id:this.entity.id,table_name:this.entity.name,data_id:this.formModel.id,operation_type:this.formModel.id?2:1},e).then((function(e){"error"!=e.state?(t.$message({message:"保存成功",type:"success"}),t.showFormDialogFlag=!1,t.loadTableData(t.searchFilter)):t.$message({message:e.msg,type:"error"})})).catch((function(e){t.$message({message:e.msg,type:"error"})}))},deleteTableData:function(e){var t=this;!0!==this.customDeleteAction?this.$confirm("是否删除该数据?","删除确认").then((function(){t.crudMethods.deleteRecord({data_id:e.id,table_id:t.entity.id,table_name:t.entity.name}).then((function(e){"error"!=e.state?(t.$message.success("删除成功"),t.loadTableData(t.searchFilter)):t.$message({message:e.msg,type:"error"})})).catch((function(e){t.$message({message:e.message,type:"error"})}))})).catch((function(){t.$message.info("取消删除")})):this.$emit("deleteTableRow",e)},handleClose:function(e){this.$confirm("确认关闭？").then((function(){e()})).catch((function(){}))}}},f=h,y=(a("b08e"),a("2877")),g=Object(y["a"])(f,i,n,!1,null,"602ad612",null),b=g.exports,F={name:"DataListView",components:{DataList:b},props:{entity:{type:Object}}},v=F,$=(a("6f11"),Object(y["a"])(v,r,o,!1,null,"630d4e5c",null));t["default"]=$.exports}}]);
//# sourceMappingURL=chunk-4e65a78d.010ff334.js.map