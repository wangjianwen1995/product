(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c164710"],{"0d27":function(e,t,a){"use strict";a("7d49")},"6f11":function(e,t,a){"use strict";a("e08a")},"7d49":function(e,t,a){},e08a:function(e,t,a){},fc42:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{direction:"horizontal"}},[a("data-list",{attrs:{entity:e.entity}})],1)},i=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dataList-container",staticStyle:{width:"100%"}},[a("el-page-header",{attrs:{content:"列表展示"},on:{back:e.goBack}}),a("div",{staticClass:"list-search-panel"},[a("div",{staticClass:"search-panel-right"},[a("el-form",{attrs:{model:e.queryForm,inline:"",size:"small"}},[e._l(e.queryList,(function(t,r){return a("el-form-item",{key:r,attrs:{label:t.label}},["text"==t.type?[a("el-input",{model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}})]:e._e(),"option"==t.type||"options"==t.type?[a("el-select",{attrs:{filterable:"",clearable:"",multiple:"options"==t.type},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.queryForm[t.prop],callback:function(a){e.$set(e.queryForm,t.prop,a)},expression:"queryForm[item.prop]"}},e._l(t.optionList,(function(e,t){return a("el-option",{key:t,attrs:{value:e.val,label:e.name}})})),1)]:e._e()],2)})),e.flowFlag?a("el-form-item",{attrs:{label:"流程状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{filterable:"",clearable:""},model:{value:e.queryForm["toexamine_result"],callback:function(t){e.$set(e.queryForm,"toexamine_result",t)},expression:"queryForm['toexamine_result']"}},[a("el-option",{attrs:{value:9,label:"完成"}}),a("el-option",{attrs:{value:0,label:"未开始"}}),a("el-option",{attrs:{value:1,label:"进行中"}}),a("el-option",{attrs:{value:-1,label:"驳回"}})],1)],1):e._e(),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.loadTableData}},[e._v("查询")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.addNewRecord}},[e._v(" 新建 ")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-download"},on:{click:e.handleDownload}},[e._v("导出")])],1)],2)],1)]),a("div",{ref:"tableContainer"},[a("div",{staticStyle:{height:"100%"}},[a("SimpleTable",{ref:"SimpleTable",attrs:{columns:e.columns,data:e.tableData,pagination:e.page,"show-check-box":!0,height:e.tableHeight+"px","table-size":"small","table-width":"100% !important"},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1),e.showFormDialogFlag?a("el-dialog",{attrs:{title:e.formTitle,visible:e.showFormDialogFlag,"destroy-on-close":!0,"close-on-click-modal":!1,"show-close":!0,"close-on-press-escape":!1},on:{"update:visible":function(t){e.showFormDialogFlag=t}}},[a("FormWidget",{ref:"formWidget",attrs:{entity:e.entity,layout:e.layout,"form-model":e.formModel,"field-props-map":e.fieldPropsMap,"labels-model":e.labelsModel,"form-state":e.formState},on:{setFormModel:e.setValue}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.showFormDialogFlag=!1}}},[e._v(" 取 消 ")])],1)],1):e._e()],1)],1)},s=[],n=a("1da1"),l=(a("b0c0"),a("d3b7"),a("159b"),a("99af"),a("e9c4"),a("96cf"),a("c65d")),c=a("9321"),u=a("365c"),d=a("ca00"),m=a("2b0e"),h=a("09ca"),f={name:"DataList",components:{FormWidget:l["default"]},props:{entity:{type:Object,default:function(){}},customAddAction:{type:Boolean,default:!1},customEditAction:{type:Boolean,default:!1},customDeleteAction:{type:Boolean,default:!1},customDataLoad:{type:Boolean,default:!1},page:{type:Object,default:function(){return{pageNo:1,limit:20,sizes:[10,20,30,50,100],total:0}}},crudMethods:{type:Object,default:function(){return{initDataList:u["u"],createRecord:u["a"],updateRecord:u["I"],saveRecord:u["C"],deleteRecord:u["f"]}}}},data:function(){return{dialogVisible:!1,entityLabel:"",idFieldName:null,nameFieldName:null,curRecordId:null,keyword:"",searchFilter:"",columns:[],tableData:[],showFormDialogFlag:!1,layout:{},formState:1,formModel:{},labelsModel:{},fieldPropsMap:{},formModelCopy:{},queryForm:{},queryList:[],flowData:[],flowFlag:!1}},computed:{tableHeight:function(){return this.$baseTableHeight()},formTitle:function(){return this.formState===c["a"].NEW?"新建"+this.entityLabel:this.formState===c["a"].EDIT?"编辑"+this.entityLabel:this.entityLabel+"详情"}},mounted:function(){var e=this;this.$nextTick((function(){e.resizeTableHeight()})),window.onresize=function(){e.resizeTableHeight()},this.initTable()},methods:{goBack:function(){this.$router.back(-1)},handleDownload:function(){},setValue:function(e){this.formModel[e.key]=e.value},handleExecute:function(e,t){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var i,o,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,executeToexamine(e);case 2:i=r.sent,i.t,o=i.state,s=i.msg,a.$message({type:o,message:s}),a.loadTableData(),t();case 9:case"end":return r.stop()}}),r)})))()},resizeTableHeight:function(){var e=this;this.$nextTick((function(){e.$refs.tableContainer.$el&&(e.tableHeight=e.$refs.tableContainer.$el.offsetHeight-42,console.log(e.tableHeight))}))},getQueryForm:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["l"])({table_id:e.entity.id});case 2:a=t.sent,r=a.t,i=a.state,o=a.msg,"success"==i?e.queryList=r||[]:e.$message({message:o,type:"error"});case 7:case"end":return t.stop()}}),t)})))()},initTable:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.entity){t.next=3;break}return e.$message.error("entity of prop is null"),t.abrupt("return");case 3:if(!0!==e.customDataLoad){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,e.crudMethods.initDataList({table_id:e.entity.id,table_name:e.entity.name,pageNum:e.page.pageNo,pageSize:e.page.limit});case 7:if(a=t.sent,"error"!=a.state){t.next=11;break}return e.$message({message:a.msg,type:"error"}),t.abrupt("return");case 11:e.getQueryForm(),e.setTableData(a.t.columnList,a.t.dataList),a&&a.t&&a.t.columnList&&a.t.columnList.length>0&&(e.flowFlag="toexamine_result"==a.t.columnList[a.t.columnList.length-1].prop);case 14:case"end":return t.stop()}}),t)})))()},setTableData:function(e,t){this.columns=e,this.columns.forEach((function(e){Object(d["setColumnFormatter"])(e)})),this.tableData=t,this.$refs.SimpleTable.tabeldata=t,this.$refs.SimpleTable.columns=e},loadTableData:function(e){var t=this,a={};_.forEach(this.queryForm,(function(e,t){_.isArray(e)?e.length>0&&(a[t]=e):e&&(a[t]=e)})),Object(u["m"])({table_id:this.entity.id,table_name:this.entity.name,pageSize:this.page.limit,pageNum:this.page.pageNo},a).then((function(e){"error"==e.state?t.$message({message:e.msg,type:"error"}):(t.tableData=e.t.dataList,t.$refs.SimpleTable.tabeldata=t.tableData)})).catch((function(e){t.$message({message:e.msg,type:"error"})}))},handleSizeChange:function(e){!0!==this.customDataLoad?this.loadTableData(this.searchFilter):this.$emit("handleSizeChange",e)},handleCurrentChange:function(e){!0!==this.customDataLoad?this.loadTableData(this.searchFilter):this.$emit("handleCurrentChange",e)},searchData:function(){if(!0!==this.customDataLoad)if(this.nameFieldName){var e=this.nameFieldName,t=this.keyword;this.searchFilter="([".concat(e,"] like '%").concat(t,"%')"),this.loadTableData(this.searchFilter)}else this.$message.error("当前实体["+this.entity+"]未指定名称字段，不能搜索！");else this.$emit("searchData",this.keyword)},clearSearch:function(){if(!0===this.customDataLoad)return this.keyword="",void this.$emit("clearSearch");this.searchFilter="",this.loadTableData()},refreshTableData:function(){!0!==this.customDataLoad?this.loadTableData(this.searchFilter):this.$emit("refreshTable")},addNewRecord:function(){var e=this;!0!==this.customAddAction?this.crudMethods.createRecord({table_id:this.entity.id,table_name:this.entity.name}).then((function(t){"error"!=t.state?t.t&&t.t.layoutJson?(e.curRecordId=null,e.layout=e.buildLayoutObj(),e.layout.setLayoutPropsFromServer(t,"add"),e.handleDeletedFields(t),e.formModel=t.t.formData,e.formModelCopy=JSON.parse(JSON.stringify(t.t.formData)),e.labelsModel=t.t.labelData,e.fieldPropsMap=t.t.fieldPropsMap,e.formState=c["a"].NEW,e.showFormDialogFlag=!0,e.$refs["formWidget"]&&e.$refs["formWidget"].clearFormValidate()):e.$message({message:"加载表单布局出错",type:"error"}):e.$message({message:t.error,type:"error"})})).catch((function(t){e.$message({message:t.message,type:"error"})})):this.$emit("addTableRecord")},buildLayoutObj:function(){var e=new m["default"];return Object(h["a"])(e)},handleDeletedFields:function(e){var t=e.t.deletedFields;if(t&&Array.isArray(t)){var a=this.layout.getAllLayoutFieldWrappers();a&&Array.isArray(a)&&a.forEach((function(e){var a=Object(d["arrayContain"])(t,e.name);a&&(e.deleted=!0)}))}},editTableData:function(e){var t=this;!0!==this.customEditAction?(this.curRecordId=e[this.idFieldName],this.crudMethods.updateRecord({data_id:e.id,table_id:this.entity.id,table_name:this.entity.name}).then((function(e){"error"!=e.state?e.t&&e.t.layoutJson?(t.layout=t.buildLayoutObj(),t.layout.setLayoutPropsFromServer(e,"add"),t.handleDeletedFields(e),t.formModel=e.t.formData,t.formModelCopy=JSON.parse(JSON.stringify(e.t.formData)),t.labelsModel=e.t.labelData,t.fieldPropsMap=e.t.fieldPropsMap,t.formState=c["a"].EDIT,t.showFormDialogFlag=!0,t.$refs["formWidget"]&&t.$refs["formWidget"].clearFormValidate()):t.$message({message:"加载表单布局出错",type:"error"}):t.$message({message:e.msg,type:"error"})})).catch((function(e){t.$message({message:e.message,type:"error"})}))):this.$emit("editTableRow",e)},hadelSave:function(e){var t=this;this.crudMethods.saveRecord({table_id:this.entity.id,table_name:this.entity.name,data_id:this.formModel.id,operation_type:this.formModel.id?2:1},e).then((function(e){"error"!=e.state?(t.$message({message:"保存成功",type:"success"}),t.showFormDialogFlag=!1,t.loadTableData(t.searchFilter)):t.$message({message:e.msg,type:"error"})})).catch((function(e){t.$message({message:e.msg,type:"error"})}))},deleteTableData:function(e){var t=this;!0!==this.customDeleteAction?this.$confirm("是否删除该数据?","删除确认").then((function(){t.crudMethods.deleteRecord({data_id:e.id,table_id:t.entity.id,table_name:t.entity.name}).then((function(e){"error"!=e.state?(t.$message.success("删除成功"),t.loadTableData(t.searchFilter)):t.$message({message:e.msg,type:"error"})})).catch((function(e){t.$message({message:e.message,type:"error"})}))})).catch((function(){t.$message.info("取消删除")})):this.$emit("deleteTableRow",e)},handleClose:function(e){this.$confirm("确认关闭？").then((function(){e()})).catch((function(){}))}}},p=f,g=(a("0d27"),a("2877")),b=Object(g["a"])(p,o,s,!1,null,"e0ed7436",null),y=b.exports,F={name:"DataListView",components:{DataList:y},props:{entity:{type:Object}}},D=F,v=(a("6f11"),Object(g["a"])(D,r,i,!1,null,"630d4e5c",null));t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-6c164710.77328bca.js.map